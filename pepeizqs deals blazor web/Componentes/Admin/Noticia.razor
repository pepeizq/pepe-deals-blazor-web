@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Identity
@using Microsoft.Data.SqlClient
@using pepeizqs_deals_web.Data

@inject NotificacionesPush Push

<style>
	.caja-admin-noticia {
		background-color: var(--fondoSubsubcabecera);
		border: 2px solid var(--fondoSubcabecera);
		padding: 20px;
		box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);
	}
</style>

@if (noticia != null)
{
	<div class="caja-admin-noticia cuerpo-ancho" style="display: flex; flex-direction: column; gap: 20px; margin-bottom: 50px;">
		<div style="display: flex; align-items: center;">
			<div style="width: 100%;">
				Admin Editar • @noticia.TituloEs
			</div>
		</div>

		<div style="display: flex; align-items: start; gap: 20px;">
			<div style="width: 15%; text-align: right; margin-top: 5px;">
				Titulo EN
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaTituloEn(e))" class="entrada-texto" rows="1">@textoTituloEn</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: start; gap: 20px;">
			<div style="width: 15%; text-align: right; margin-top: 5px;">
				Titulo ES
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaTituloEs(e))" class="entrada-texto" rows="1">@textoTituloEs</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: start; gap: 20px;">
			<div style="width: 15%;text-align: right; margin-top: 5px;">
				Imagen
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaImagen(e))" class="entrada-texto" rows="1">@textoImagen</textarea>
				<img src="@textoImagen" style="margin-top: 10px; max-height: 150px;"/>
			</div>
		</div>

		<div style="display: flex; align-items: start; gap: 20px;">
			<div style="width: 15%; text-align: right; margin-top: 5px;">
				Tipo
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaTipo(e))" class="entrada-texto" rows="1">@textoTipo</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Enlace
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaEnlace(e))" class="entrada-texto" rows="1">@textoEnlace</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Fecha Termina
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaFechaTermina(e))" class="entrada-texto" rows="1">@textoFechaTermina</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Contenido EN
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaContenidoEn(e))" class="entrada-texto" rows="10">@textoContenidoEn</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Contenido ES
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaContenidoEs(e))" class="entrada-texto" rows="10">@textoContenidoEs</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Bundle Id
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaBundleId(e))" class="entrada-texto" rows="1">@textoBundleId</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Gratis Ids
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaGratisIds(e))" class="entrada-texto" rows="1">@textoGratisIds</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Suscripciones Ids
			</div>

			<div style="width: 85%;">
				<textarea @onchange="(e => TextoCambiaSuscripcionesIds(e))" class="entrada-texto" rows="1">@textoSuscripcionesIds</textarea>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Correo de Prueba
			</div>

			<div style="width: 85%; display: flex; align-items: center; gap: 20px;">
				<button @onclick="(e => EnviarCorreoPruebaMsn(e))" class="boton-pequeño" style="width: fit-content; padding: 10px 20px;">
					Enviar (Msn)
				</button>

				<button @onclick="(e => EnviarCorreoPruebaGmail(e))" class="boton-pequeño" style="width: fit-content; padding: 10px 20px;">
					Enviar (Gmail)
				</button>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 20px;">
			<div style="width: 15%; text-align: right;">
				Redes Sociales
			</div>

			<div style="width: 85%; display: flex; align-items: center; gap: 20px;">
				<button @onclick="(e => EnviarTwitter(e))" class="boton-pequeño" style="width: auto; padding: 10px 20px;">
					Twitter
				</button>

				<button @onclick="(e => EnviarBlueSky(e))" class="boton-pequeño" style="width: auto; padding: 10px 20px;">
					BlueSky
				</button>

				<button @onclick="(e => EnviarTelegram(e))" class="boton-pequeño" style="width: auto; padding: 10px 20px;">
					Telegram
				</button>

				<button @onclick="(e => EnviarDiscord(e))" class="boton-pequeño" style="width: auto; padding: 10px 20px;">
					Discord
				</button>

				<button @onclick="(e => EnviarReddit(e))" class="boton-pequeño" style="width: auto; padding: 10px 20px;">
					Reddit
				</button>

				<button @onclick="(e => EnviarNotificacionesPush(e))" class="boton-pequeño" style="width: auto; padding: 10px 20px;">
					Notificaciones Push
				</button>
			</div>
		</div>
	</div>
}

@code {

	#nullable disable

	[Parameter]
	public string idioma { get; set; }

	[Parameter]
	public string dominio { get; set; }

	[Parameter]
	public int noticiaId { get; set; }

	public global::Noticias.Noticia noticia = new global::Noticias.Noticia();

	protected override async Task OnParametersSetAsync()
	{
		noticia = await BaseDatos.Noticias.Buscar.UnaNoticia(noticiaId);

		if (noticia != null)
		{
			textoTituloEn = noticia.TituloEn;
			textoTituloEs = noticia.TituloEs;
			textoImagen = noticia.Imagen;
			textoTipo = (int)noticia.NoticiaTipo;
			textoEnlace = noticia.Enlace;
			textoFechaTermina = noticia.FechaTermina.ToString();
			textoContenidoEn = noticia.ContenidoEn;
			textoContenidoEs = noticia.ContenidoEs;
			textoBundleId = noticia.BundleId.ToString();
			textoGratisIds = noticia.GratisIds;
			textoSuscripcionesIds = noticia.SuscripcionesIds;
		}
	}

	private string textoTituloEn = string.Empty;

	private async Task TextoCambiaTituloEn(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoTituloEn = nuevoTexto;

			await BaseDatos.Noticias.Actualizar.TituloEn(noticiaId.ToString(), nuevoTexto);
		}
	}

	private string textoTituloEs = string.Empty;

	private async Task TextoCambiaTituloEs(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoTituloEs = nuevoTexto;

			await BaseDatos.Noticias.Actualizar.TituloEs(noticiaId.ToString(), nuevoTexto);
		}
	}

	private string textoImagen = string.Empty;

	private async Task TextoCambiaImagen(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoImagen = nuevoTexto;

			await BaseDatos.Noticias.Actualizar.Imagen(noticiaId.ToString(), nuevoTexto);
		}
	}

	private int textoTipo = 0;

	private async Task TextoCambiaTipo(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoTipo = int.Parse(nuevoTexto);

			await BaseDatos.Noticias.Actualizar.Tipo(noticiaId.ToString(), nuevoTexto);
		}
	}

	private string textoEnlace = string.Empty;

	private async Task TextoCambiaEnlace(ChangeEventArgs texto)
	{
		string nuevoTexto = texto.Value.ToString().Trim();
		textoEnlace = nuevoTexto;

		await BaseDatos.Noticias.Actualizar.Enlace(noticiaId.ToString(), nuevoTexto);
	}

	private string textoFechaTermina = string.Empty;

	private async Task TextoCambiaFechaTermina(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoFechaTermina = nuevoTexto;

			await BaseDatos.Noticias.Actualizar.FechaTermina(noticiaId.ToString(), nuevoTexto);
		}
	}

	private string textoContenidoEn = string.Empty;

	private async Task TextoCambiaContenidoEn(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoContenidoEn = nuevoTexto;

			await BaseDatos.Noticias.Actualizar.ContenidoEn(noticiaId.ToString(), nuevoTexto);
		}
	}

	private string textoContenidoEs = string.Empty;

	private async Task TextoCambiaContenidoEs(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();
			textoContenidoEs = nuevoTexto;

			await BaseDatos.Noticias.Actualizar.ContenidoEs(noticiaId.ToString(), nuevoTexto);
		}
	}

	private string textoBundleId = string.Empty;

	private async Task TextoCambiaBundleId(ChangeEventArgs texto)
	{
		string nuevoTexto = texto.Value.ToString().Trim();
		textoBundleId = nuevoTexto;

		await BaseDatos.Noticias.Actualizar.BundleId(noticiaId.ToString(), nuevoTexto);
	}

	private string textoGratisIds = string.Empty;

	private async Task TextoCambiaGratisIds(ChangeEventArgs texto)
	{
		string nuevoTexto = texto.Value.ToString().Trim();
		textoGratisIds = nuevoTexto;

		await BaseDatos.Noticias.Actualizar.GratisIds(noticiaId.ToString(), nuevoTexto);
	}

	private string textoSuscripcionesIds = string.Empty;

	private async Task TextoCambiaSuscripcionesIds(ChangeEventArgs texto)
	{
		string nuevoTexto = texto.Value.ToString().Trim();
		textoSuscripcionesIds = nuevoTexto;

		await BaseDatos.Noticias.Actualizar.SuscripcionesIds(noticiaId.ToString(), nuevoTexto);
	}

	private void EnviarCorreoPruebaMsn(MouseEventArgs e)
	{
		Herramientas.Correos.Noticias.Enviar(noticia, "pepeizq@msn.com", "es-ES", dominio);
	}

	private void EnviarCorreoPruebaGmail(MouseEventArgs e)
	{
		Herramientas.Correos.Noticias.Enviar(noticia, "joseluis.izquierdo.gomez@gmail.com", "es-ES", dominio);
	}

	private async void EnviarTwitter(MouseEventArgs e)
	{
		await Herramientas.RedesSociales.Twitter.Twitear(noticia, dominio);
	}

	private async void EnviarBlueSky(MouseEventArgs e)
	{
		await Herramientas.RedesSociales.Bluesky.Postear(noticia, dominio);
	}

	private async void EnviarTelegram(MouseEventArgs e)
	{
		await Herramientas.RedesSociales.Telegram.Postear(noticia, dominio);
	}

	private async void EnviarDiscord(MouseEventArgs e)
	{
		await Herramientas.RedesSociales.Discord.Postear(noticia, dominio);
	}

	private async void EnviarReddit(MouseEventArgs e)
	{
		await Herramientas.RedesSociales.Reddit.Postear(noticia, dominio);
	}

	private async Task EnviarNotificacionesPush(MouseEventArgs e)
	{
		await Push.SendNotificationToAllAsync(noticia.TituloEn, "Mensaje", noticia.Enlace);
	}
}
