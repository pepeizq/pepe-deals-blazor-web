@page "/historical-lows/"

@using APIs.Steam
@using BaseDatos.Juegos
@using Juegos
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Web.Virtualization
@using Microsoft.AspNetCore.Identity
@using Microsoft.Data.SqlClient
@using Microsoft.JSInterop
@using pepeizqs_deals_web.Data
@using pepeizqs_deals_blazor_web.Componentes.Interfaz
@using System.Text.Json
@using Tiendas2

@inject IHttpContextAccessor Contexto
@inject IJSRuntime JavaScript

<Titulo tipo="@Titulo.Tipo.Minimos" idioma="@idioma" dominio="@dominio"/>

<script>
	window.ChangeUrl = function (url) {
		history.pushState(null, '', url);
	}
</script>

<style>
	.cargando {
		width: 48px;
		height: 48px;
		border: 5px solid var(--colorTexto);
		border-bottom-color: transparent;
		border-radius: 50%;
		display: inline-block;
		box-sizing: border-box;
		animation: rotation 1s linear infinite;
	}

	@@keyframes rotation {
	0% {
	transform: rotate(0deg);
	}

	100% {
	transform: rotate(360deg);
	}
	}
</style>

<style>
	:root {
		--glaseadoBorde: #FFFFFF1A;
		--glaseadoFondo: rgba(45, 47, 54, 0.70);
		--noResultados: rgba(132, 32, 41, 0.5);
		--botonSeleccionado: rgba(13, 22, 33, 0.75);
		--glaseadoFondo2: rgba(0, 32, 51, 0.9);
		--glaseadoBorde2: rgba(0, 255, 255, 0.10);
	}

	.caja-minimos {
		box-shadow: 0 22px 34px 0 rgba(0, 0, 0, 0.25);
		background-blend-mode: overlay;
		border-radius: 100px;
		border: 2px solid var(--glaseadoBorde);
		width: fit-content;
		background-color: var(--fondoSubcabecera);
		backdrop-filter: blur(25px);
		display: flex;
		align-items: center;
		gap: 20px;
		padding: 5px;
	}

	.caja-minimos-animacion {
		opacity: 0;
		transition: all 0.5s ease, transform .2s ease;
		pointer-events: none;
		transform: scaleX(0);
		transform-origin: left;
		max-width: 0;
	}

		.caja-minimos-animacion.visible {
			opacity: 1;
			pointer-events: auto;
			transform: scaleX(1);
			max-width: fit-content;
		}

	.boton-minimos {
		backdrop-filter: brightness(100%);
		transition: backdrop-filter 0.2s ease;
	}

		.boton-minimos:hover {
			backdrop-filter: brightness(50%);
		}

	.menu-dropdown2 {
		position: relative;
		display: inline-block;
		z-index: 5000;
	}

		.menu-dropdown2::after {
			content: "";
			position: absolute;
			top: 100%;
			left: 0;
			height: 20px;
			width: 100%;
		}

	.menu-dropdown-contenido-centrado {
		position: absolute;
		top: 120%;
		left: 50%;
		transform: translate(-50%, -8px);
		min-width: 200px;
		padding: 8px;
		background: var(--glaseadoFondo2);
		border-radius: 14px;
		box-shadow: 0 20px 40px rgba(0,0,0,.25);
		opacity: 0;
		pointer-events: none;
		transition: opacity .2s ease, transform .2s ease;
		border: 2px solid var(--glaseadoBorde2);
		z-index: 1000;
	}

	.menu-dropdown2:hover .menu-dropdown-contenido-centrado {
		opacity: 1;
		transform: translate(-50%, 0);
		pointer-events: auto;
	}

	.menu-dropdown-contenido-centrado a {
		display: block;
		padding: 12px 16px;
		border-radius: 10px;
		text-decoration: none;
	}

		.menu-dropdown-contenido-centrado a:hover {
			background: rgba(99, 102, 241,.15);
		}
</style>

@if (cargado == false)
{
	<div style="min-height: 200px; display: flex; align-items: center; justify-content: space-around;">
		<div class="cargando" />
	</div>
}
else
{
	<div style="display: flex; align-items: center; justify-content: center; margin-top: 40px; transition: transform 0.3s ease, opacity 0.3s ease; flex-wrap: wrap;">
		<div class="caja-minimos">
			<button class="boton-minimos" style="background-color: var(--botonSeleccionado); border: 0px; height: 50px; padding: 15px 25px; display: inline-flex; align-items: center; color: var(--colorTexto); border-radius: inherit;">
				<div>
					<h1 style="font-size: 16px; margin: 0px;">
						@Herramientas.Idiomas.BuscarTexto(idioma, "String1", "HistoricalLows")
					</h1>
				</div>
			</button>
		</div>

		<div class="tooltip-juego" onmousemove="enseñarTooltip(event, 'tooltip-lows-order')">
			<button @onclick="MostrarOcultarOrdenar" style="background: transparent; border: 0px; margin-left: 30px;">
				<div style="width: 24px; height: 24px;">
					<svg class="svg-boton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
						<path d="M130.4 268.2C135.4 280.2 147 288 160 288L480 288C492.9 288 504.6 280.2 509.6 268.2C514.6 256.2 511.8 242.5 502.7 233.3L342.7 73.3C330.2 60.8 309.9 60.8 297.4 73.3L137.4 233.3C128.2 242.5 125.5 256.2 130.5 268.2zM130.4 371.7C125.4 383.7 128.2 397.4 137.3 406.6L297.3 566.6C309.8 579.1 330.1 579.1 342.6 566.6L502.6 406.6C511.8 397.4 514.5 383.7 509.5 371.7C504.5 359.7 492.9 352 480 352L160 352C147.1 352 135.4 359.8 130.4 371.8z" />
					</svg>
				</div>
			</button>

			<div id="tooltip-lows-order" class="tooltip-relleno">
				<div style="margin: 8px; max-width: 300px; font-size: 14px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String2", "HistoricalLows")
				</div>
			</div>
		</div>

		<div style="display: flex; align-items: center; gap: 25px; max-width: 500px; height: 45px; margin-left: 25px; @anchoBuscador">
			<div class="tooltip-juego" onmousemove="enseñarTooltip(event, 'tooltip-lows-search')">
				<button @onclick="MostrarOcultarBuscador" style="background: transparent; border: 0px;">
					<div style="width: 24px; height: 24px;">
						<svg class="svg-boton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
							<path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z" />
						</svg>
					</div>
				</button>

				<div id="tooltip-lows-search" class="tooltip-relleno">
					<div style="margin: 8px; max-width: 300px; font-size: 14px;">
						@Herramientas.Idiomas.BuscarTexto(idioma, "String9", "HistoricalLows")
					</div>
				</div>
			</div>

			<div class="caja-minimos caja-minimos-animacion @(mostrarBuscador ? "visible" : "")">
				<input type="text" @bind-value="textoBuscador" @bind-value:event="oninput" @bind-value:after="TextoCambiaBuscador" @onclick="ClickBuscador" @onfocusout="PerderBuscador" class="entrada-texto" style="border-radius: inherit; color: var(--colorTexto); padding: 5px 15px; border: 0px; transition: background-color 1000ms linear; @fondoBuscador" placeholder="@Herramientas.Idiomas.BuscarTexto(idioma, "String13", "Subscriptions")" />
			</div>
		</div>

		<div class="tooltip-juego" onmousemove="enseñarTooltip(event, 'tooltip-lows-options')">
			<button @onclick="MostrarOcultarOpciones" style="background: transparent; border: 0px; margin-left: 25px;">
				<div style="width: 24px; height: 24px;">
					<svg class="svg-boton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
						<path d="M259.1 73.5C262.1 58.7 275.2 48 290.4 48L350.2 48C365.4 48 378.5 58.7 381.5 73.5L396 143.5C410.1 149.5 423.3 157.2 435.3 166.3L503.1 143.8C517.5 139 533.3 145 540.9 158.2L570.8 210C578.4 223.2 575.7 239.8 564.3 249.9L511 297.3C511.9 304.7 512.3 312.3 512.3 320C512.3 327.7 511.8 335.3 511 342.7L564.4 390.2C575.8 400.3 578.4 417 570.9 430.1L541 481.9C533.4 495 517.6 501.1 503.2 496.3L435.4 473.8C423.3 482.9 410.1 490.5 396.1 496.6L381.7 566.5C378.6 581.4 365.5 592 350.4 592L290.6 592C275.4 592 262.3 581.3 259.3 566.5L244.9 496.6C230.8 490.6 217.7 482.9 205.6 473.8L137.5 496.3C123.1 501.1 107.3 495.1 99.7 481.9L69.8 430.1C62.2 416.9 64.9 400.3 76.3 390.2L129.7 342.7C128.8 335.3 128.4 327.7 128.4 320C128.4 312.3 128.9 304.7 129.7 297.3L76.3 249.8C64.9 239.7 62.3 223 69.8 209.9L99.7 158.1C107.3 144.9 123.1 138.9 137.5 143.7L205.3 166.2C217.4 157.1 230.6 149.5 244.6 143.4L259.1 73.5zM320.3 400C364.5 399.8 400.2 363.9 400 319.7C399.8 275.5 363.9 239.8 319.7 240C275.5 240.2 239.8 276.1 240 320.3C240.2 364.5 276.1 400.2 320.3 400z" />
					</svg>
				</div>
			</button>

			<div id="tooltip-lows-options" class="tooltip-relleno">
				<div style="margin: 8px; max-width: 300px; font-size: 14px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String44", "HistoricalLows")
				</div>
			</div>
		</div>
	</div>

	<div style="margin-top: 30px; display: flex; align-items: center; justify-content: center; background-color: var(--fondoSubsubcabecera); padding: 20px;">
		<a @onclick="MostrarOcultarDRMs" class="boton-minimos" style="cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="display: flex; align-items: center; gap: 10px;">
				@{
					int contadorDRMs = 0;

					foreach (var drm in drmsListado)
					{
						if (drm.Estado == true)
						{
							contadorDRMs += 1;
						}
					}
				}

				@Herramientas.Idiomas.BuscarTexto(idioma, "String14", "HistoricalLows") (@contadorDRMs.ToString())
			</div>
		</a>

		<a @onclick="MostrarOcultarTiendas" class="boton-minimos" style="cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="display: flex; align-items: center; gap: 10px;">
				@{
					int contadorTiendas = 0;

					foreach (var tienda in tiendas)
					{
						if (tienda.Estado == true)
						{
							contadorTiendas += 1;
						}
					}
				}

				@Herramientas.Idiomas.BuscarTexto(idioma, "String15", "HistoricalLows") (@contadorTiendas.ToString())
			</div>
		</a>

		<a @onclick="MostrarOcultarCategorias" class="boton-minimos" style="cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="display: flex; align-items: center; gap: 10px;">
				@{
					int contadorCategorias = 0;

					foreach (var categoria in categorias)
					{
						if (categoria.Estado == true)
						{
							contadorCategorias += 1;
						}
					}
				}

				@Herramientas.Idiomas.BuscarTexto(idioma, "String17", "HistoricalLows") (@contadorCategorias.ToString())
			</div>
		</a>

		<a @onclick="MostrarOcultarLanzamiento" class="boton-minimos" style="cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="display: flex; align-items: center; gap: 10px;">
				@Herramientas.Idiomas.BuscarTexto(idioma, "String29", "HistoricalLows")
			</div>
		</a>

		<a @onclick="MostrarOcultarIA" class="boton-minimos" style="cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="display: flex; align-items: center; gap: 10px;">
				@Herramientas.Idiomas.BuscarTexto(idioma, "String36", "HistoricalLows")
			</div>
		</a>

		<div class="menu-dropdown2 boton-minimos" style="margin-left: 40px; cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="cursor: pointer; color: var(--colorEnlace);">
				@Herramientas.Idiomas.BuscarTexto(idioma, "String46", "HistoricalLows")
			</div>

			<div class="menu-dropdown-contenido-centrado">
				<a class="texto-cabecera boton-superior" href="/steamdeck" style="font-size: 15px;">
					<div style="text-align: center; display: flex; align-items: center; gap: 15px; justify-content: center;">
						<img src="/imagenes/otros/steamdeck_cabecera.webp" style="max-width: 20px; max-height: 20px;" alt="Steam Deck" />

						<div>
							Steam Deck
						</div>
					</div>
				</a>
				<a class="texto-cabecera boton-superior" href="/steamos" style="font-size: 15px;">
					<div style="text-align: center; display: flex; align-items: center; gap: 15px; justify-content: center;">
						<img src="@Juegos.JuegoDRM2.SacarImagen(Juegos.JuegoDRM.Steam)" style="max-width: 20px; max-height: 20px;" alt="SteamOS" />

						<div>
							SteamOS
						</div>
					</div>
				</a>
			</div>
		</div>

		<div class="menu-dropdown2 boton-minimos" style="cursor: pointer; color: var(--colorEnlace); text-decoration: none; padding: 10px 15px; border-radius: 20px;">
			<div style="cursor: pointer; color: var(--colorEnlace);">
				@Herramientas.Idiomas.BuscarTexto(idioma, "String47", "HistoricalLows")
			</div>

			<div class="menu-dropdown-contenido-centrado">
				<a class="texto-cabecera boton-superior" href="/geforcenow" style="font-size: 15px;">
					<div style="text-align: center; display: flex; align-items: center; gap: 15px; justify-content: center;">
						<img src="/imagenes/streaming/geforcenow_icono.webp" style="max-width: 20px; max-height: 20px;" alt="Geforce NOW" />

						<div>
							Geforce NOW
						</div>
					</div>
				</a>
				<a class="texto-cabecera boton-superior" href="/boosteroid" style="font-size: 15px;">
					<div style="text-align: center; display: flex; align-items: center; gap: 15px; justify-content: center;">
						<img src="/imagenes/streaming/boosteroid_icono.webp" style="max-width: 20px; max-height: 20px;" alt="Boosteroid" />

						<div>
							Boosteroid
						</div>
					</div>
				</a>
				<a class="texto-cabecera boton-superior" href="/luna" style="font-size: 15px;">
					<div style="text-align: center; display: flex; align-items: center; gap: 15px; justify-content: center;">
						<img src="/imagenes/streaming/amazonluna_icono.webp" style="max-width: 20px; max-height: 20px;" alt="Amazon Luna" />

						<div>
							Amazon Luna
						</div>
					</div>
				</a>
			</div>
		</div>
	</div>
	
	<div style="max-width: 1000px; margin: 30px auto 40px auto;">
		@if (juegosMostrar?.Count > 0)
		{
			<div style="display: flex; flex-direction: column; gap: 25px; margin-top: -15px;">
				<Virtualize Context="juego" Items="@juegosMostrar" ItemSize="107" OverscanCount="5">
					<ItemContent>
						<div style="display: flex; align-items: center; gap: 20px; position: relative; overflow: hidden; box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.28),0px 0px 1px 0px rgba(0, 0, 0, 0.24);" @onmouseenter="(e => MostrarBotonDeseados(e, juego))" @onmouseleave="(e => OcultarBotonDeseados(e, juego))">
							<div style="width: 100%;">
								<CajaJuego idioma="@idioma" juego="@juego.Juego" color="@juego.Color" juegosUsuario="@juegosUsuario" usuarioDeseadosSteam="@deseadosUsuario?.SteamWishlist" usuarioDeseadosWeb="@deseadosUsuario?.Wishlist" usuarioDeseadosGog="@deseadosUsuario?.GogWishlist" tipo="CajaJuego.Tipo.MinimosHistoricos" userAgent="@userAgent" />
							</div>
						
							@if (string.IsNullOrEmpty(usuarioId) == false && juego.Color != "var(--fondoBien)" && juego.DeseadoImportado == false && juego.DeseadoMostrar == true)
							{
								<div style="position: absolute; top: 0; left: 0;" class="tooltip-juego" onmousemove="enseñarTooltip(event, 'tooltip-deseados')">
									<button @onclick="@(e => CambiarEstadoDeseado(e, usuarioId, juego, juego.Juego.PrecioMinimosHistoricos[0].DRM))" class="boton-pequeño" style="width: fit-content; padding: 10px; background-color: @juego.Color;">
										<div class="svg-boton" style="width: 24px; height: 24px; display: flex;">
											@if (juego.Color == "var(--fondoAlerta)")
											{
												<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
													<path d="M183.1 137.4C170.6 124.9 150.3 124.9 137.8 137.4C125.3 149.9 125.3 170.2 137.8 182.7L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7L320.5 365.3L457.9 502.6C470.4 515.1 490.7 515.1 503.2 502.6C515.7 490.1 515.7 469.8 503.2 457.3L365.8 320L503.1 182.6C515.6 170.1 515.6 149.8 503.1 137.3C490.6 124.8 470.3 124.8 457.8 137.3L320.5 274.7L183.1 137.4z" />
												</svg>
											}
											else
											{
												<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
													<path d="M341.5 45.1C337.4 37.1 329.1 32 320.1 32C311.1 32 302.8 37.1 298.7 45.1L225.1 189.3L65.2 214.7C56.3 216.1 48.9 222.4 46.1 231C43.3 239.6 45.6 249 51.9 255.4L166.3 369.9L141.1 529.8C139.7 538.7 143.4 547.7 150.7 553C158 558.3 167.6 559.1 175.7 555L320.1 481.6L464.4 555C472.4 559.1 482.1 558.3 489.4 553C496.7 547.7 500.4 538.8 499 529.8L473.7 369.9L588.1 255.4C594.5 249 596.7 239.6 593.9 231C591.1 222.4 583.8 216.1 574.8 214.7L415 189.3L341.5 45.1z" />
												</svg>
											}
										</div>
									</button>

									<div id="tooltip-deseados" class="tooltip-relleno">
										<div style="margin: 4px; font-size: 14px;">
											@if (juego.Color == "var(--fondoAlerta)")
											{
												@Herramientas.Idiomas.BuscarTexto(idioma, "String13", "Index")
											}
											else
											{
												@Herramientas.Idiomas.BuscarTexto(idioma, "String12", "Index")
											}
										</div>
									</div>
								</div>
							}
						</div>
					</ItemContent>
				</Virtualize>
			</div>

			@if (Herramientas.Bots.UserAgentEsBot(userAgent) == false && string.IsNullOrEmpty(textoBuscador) == true)
			{
				<div style="margin-top: 20px; width: 100%; display: flex; align-items: center; gap: 20px; justify-content: center;">
					@if (cargandoMas == false)
					{
						<button class="boton-pequeño" @onclick="CargarMasMinimos" style="width: fit-content; padding: 10px 25px;">
							@Herramientas.Idiomas.BuscarTexto(idioma, "String41", "HistoricalLows")
						</button>
					}
					else
					{
						<div style="padding: 10px 25px;">
							@Herramientas.Idiomas.BuscarTexto(idioma, "String42", "HistoricalLows")
						</div>
					}
				</div>
			}
		}
	</div>
}

@if (mostrarOrdenar == true)
{
	<div class="opciones-panel">
		<div style="max-width: 500px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; position: relative; justify-content: center; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); justify-content: center;">
				<button class="boton-pequeño" @onclick="MostrarOcultarOrdenar" style="width: fit-content; padding: 10px 15px; position: absolute; left: 30px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String2", "HistoricalLows")
				</div>
			</div>

			<div style="padding: 30px; display: flex; flex-direction: column; gap: 20px;">
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarReseñasPorcentaje(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String3", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarReseñasCantidad(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String4", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarNombreAZ(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String5", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarNombreZA(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String6", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarPrecio(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String7", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarDescuento(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String8", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarFechaDetectado(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String34", "HistoricalLows")
				</button>
				<button class="boton-pequeño" style="padding: 15px 25px; text-align: center;" @onclick="(e => OrdenarFechaLanzamiento(true))">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String35", "HistoricalLows")
				</button>
			</div>
		</div>
	</div>
}

@if (mostrarOpciones == true)
{
	<div class="opciones-panel">
		<div style="max-width: 800px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño));">
				<button class="boton-pequeño" @onclick="MostrarOcultarOpciones" style="width: fit-content; padding: 10px 15px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String44", "HistoricalLows")
				</div>
			</div>

			<div style="display: flex; flex-direction: column; gap: 30px; padding: 30px;">
				@if (string.IsNullOrEmpty(usuarioId) == false)
				{
					<div style="display: flex; align-items: center; gap: 20px;">
						<div class="checkbox-caja">
							<input type="checkbox" class="checkbox-interior" checked="@ocultarJuegosUsuarioSteam" @onchange="OcultarJuegosUsuarioSteam">
						</div>

						<div>
							@string.Format(Herramientas.Idiomas.BuscarTexto(idioma, "String45", "HistoricalLows"), "Steam")
						</div>
					</div>

					<div style="display: flex; align-items: center; gap: 20px; margin-bottom: 10px;">
						<div class="checkbox-caja">
							<input type="checkbox" class="checkbox-interior" checked="@ocultarJuegosUsuarioGog" @onchange="OcultarJuegosUsuarioGog">
						</div>

						<div>
							@string.Format(Herramientas.Idiomas.BuscarTexto(idioma, "String45", "HistoricalLows"), "GOG")
						</div>
					</div>
				}

				 <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px;">
					<div style="display: flex; flex-direction: column; gap: 10px;">
						<div style="margin-left: 15px;">
							@Herramientas.Idiomas.BuscarTexto(idioma, "String13", "HistoricalLows")
						</div>

						<div style="display: flex; align-items: center; gap: 5px; border-radius: 10px; padding: 5px; background: color-mix(in srgb, var(--fondoSubcabecera) 25%, var(--fondoBotonPequeño)); border: 2px solid var(--fondoBotonPequeño);">
							<div style="background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); width: 100%; border-radius: inherit; border: 1px solid var(--glaseadoBorde); padding: 10px 15px;">
								<input type="range" min="5" max="100" step="5" list="precios" @bind-value="precioMaximo" @bind-value:event="oninput" @bind-value:after="CambiarPrecioMaximo" style="width: 100%;" />

								<datalist id="precios">
									<option value="5" label="5€"></option>
									<option value="20" label="20€"></option>
									<option value="40" label="40€"></option>
									<option value="60" label="60€"></option>
									<option value="80" label="80€"></option>
									<option value="100" label="100€"></option>
								</datalist>
							</div>

							<div style="width: 20%; text-align: center;">
								@precioMaximo€
							</div>
						</div>
					</div>

					<div style="display: flex; flex-direction: column; gap: 10px;">
						<div style="margin-left: 15px;">
							@Herramientas.Idiomas.BuscarTexto(idioma, "String12", "HistoricalLows")
						</div>

						<div style="display: flex; align-items: center; gap: 5px; border-radius: 10px; padding: 5px; background: color-mix(in srgb, var(--fondoSubcabecera) 25%, var(--fondoBotonPequeño)); border: 2px solid var(--fondoBotonPequeño);">
							<div style="background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); width: 100%; border-radius: inherit; border: 1px solid var(--glaseadoBorde); padding: 10px 15px;">
								<input type="range" min="5" max="95" step="5" list="descuentos" @bind-value="descuentoMinimo" @bind-value:event="oninput" @bind-value:after="CambiarDescuentoMinimo" style="width: 100%;" />

								<datalist id="descuentos">
									<option value="5" label="5%"></option>
									<option value="20" label="20%"></option>
									<option value="40" label="40%"></option>
									<option value="60" label="60%"></option>
									<option value="80" label="80%"></option>
									<option value="95" label="95%"></option>
								</datalist>
							</div>

							<div style="width: 20%; text-align: center;">
								@descuentoMinimo%
							</div>
						</div>
					</div>
				</div>
				
				<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px;">
					<div style="display: flex; flex-direction: column; gap: 10px;">
						<div style="margin-left: 15px;">
							@Herramientas.Idiomas.BuscarTexto(idioma, "String40", "HistoricalLows")
						</div>

						<div style="display: flex; align-items: center; gap: 5px; border-radius: 10px; padding: 5px; background: color-mix(in srgb, var(--fondoSubcabecera) 25%, var(--fondoBotonPequeño)); border: 2px solid var(--fondoBotonPequeño);">
							<div style="background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); width: 100%; border-radius: inherit; border: 1px solid var(--glaseadoBorde); padding: 10px 15px;">
								<input type="range" min="0" max="10000" step="500" list="resenas" @bind-value="minimoReseñas" @bind-value:event="oninput" @bind-value:after="CambiarReseñasMinimo" style="width: 100%;" />

								<datalist id="resenas">
									<option value="0" label="0"></option>
									<option value="2000" label="2000"></option>
									<option value="4000" label="4000"></option>
									<option value="6000" label="6000"></option>
									<option value="8000" label="8000"></option>
									<option value="10000" label="10000"></option>
								</datalist>
							</div>

							<div style="width: 20%; text-align: center;">
								@minimoReseñas
							</div>
						</div>
					</div>
				</div> 
			</div>
		</div>
	</div>
}

@if (enseñarDRMs == true)
{
	<div class="opciones-panel">
		<div style="max-width: 600px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; position: relative; justify-content: center; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); justify-content: center;">
				<button class="boton-pequeño" @onclick="MostrarOcultarDRMs" style="width: fit-content; padding: 10px 15px; position: absolute; left: 30px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String14", "HistoricalLows")
				</div>
			</div>

			<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 30px; padding: 30px;">
				@foreach (var drm in drmsListado)
				{
					string iconoDRM = string.Empty;
					string nombreDRM = string.Empty;

					foreach (var drm2 in JuegoDRM2.GenerarListado())
					{
						if (drm2.Id == drm.DRMId)
						{
							iconoDRM = drm2.Imagen;
							nombreDRM = drm2.Nombre;
						}
					}

					<div style="display: flex; align-items: center;" title="@nombreDRM">
						<div class="checkbox-caja">
							<input type="checkbox" class="checkbox-interior" checked="@drm.Checkbox" @onchange="@(e => EnseñarJuegosDRM(e, drm.DRMId))">
						</div>

						@if (drm.DRMId != JuegoDRM.DRMFree)
						{
							<div style="margin-left: 20px;">
								<img src="@iconoDRM" style="max-width: 28px; max-height: 28px;" title="@nombreDRM" />
							</div>
						}
						else
						{
							<div style="margin-left: 20px;">
								<label style="font-size: 10px; max-width: 28px; text-align: center;">@nombreDRM</label>
							</div>
						}
					</div>
				}
			</div>
		</div>
	</div>
}

@if (enseñarTiendas == true)
{
	<div class="opciones-panel">
		<div style="max-width: 600px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; position: relative; justify-content: center; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); justify-content: center;">
				<button class="boton-pequeño" @onclick="MostrarOcultarTiendas" style="width: fit-content; padding: 10px 15px; position: absolute; left: 30px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String15", "HistoricalLows")
				</div>
			</div>

			<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 30px; padding: 30px;">
				@foreach (var tienda in tiendas)
				{
					string iconoTienda = string.Empty;
					string nombreTienda = string.Empty;

					foreach (var tienda2 in Tiendas2.TiendasCargar.GenerarListado())
					{
						if (tienda2.Id == tienda.TiendaId)
						{
							iconoTienda = tienda2.ImagenIcono;
							nombreTienda = tienda2.Nombre;
						}
					}

					<div style="display: flex; align-items: center; gap: 20px;" title="@nombreTienda">
						<div class="checkbox-caja">
							<input type="checkbox" class="checkbox-interior" checked="@tienda.Checkbox" @onchange="@(e => EnseñarJuegosTienda(e, tienda.TiendaId))">
						</div>

						<div>
							<img src="@iconoTienda" style="width: 28px; height: 28px;" title="@nombreTienda" />
						</div>
					</div>
				}
			</div>
		</div>
	</div>
}

@if (enseñarCategorias == true)
{
	<div class="opciones-panel">
		<div style="max-width: 500px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; position: relative; justify-content: center; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); justify-content: center;">
				<button class="boton-pequeño" @onclick="MostrarOcultarCategorias" style="width: fit-content; padding: 10px 15px; position: absolute; left: 30px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String17", "HistoricalLows")
				</div>
			</div>

			<div style="display: flex; flex-direction: column; gap: 30px; padding: 30px;">
				@foreach (var categoria in categorias)
				{
					string nombreCategoria = string.Empty;

					if (categoria.Categoria == JuegoTipo.Game)
					{
						nombreCategoria = Herramientas.Idiomas.BuscarTexto(idioma, "String18", "HistoricalLows");
					}
					else if (categoria.Categoria == JuegoTipo.DLC)
					{
						nombreCategoria = Herramientas.Idiomas.BuscarTexto(idioma, "String19", "HistoricalLows");
					}
					else if (categoria.Categoria == JuegoTipo.Music)
					{
						nombreCategoria = Herramientas.Idiomas.BuscarTexto(idioma, "String20", "HistoricalLows");
					}
					else if (categoria.Categoria == JuegoTipo.Software)
					{
						nombreCategoria = Herramientas.Idiomas.BuscarTexto(idioma, "String21", "HistoricalLows");
					}

					<div style="display: flex; align-items: center; gap: 20px;" title="@nombreCategoria">
						<div class="checkbox-caja">
							<input type="checkbox" class="checkbox-interior" checked="@categoria.Checkbox" @onchange="@(e => EnseñarJuegosCategoria(e, categoria.Categoria))">
						</div>

						<div>
							@nombreCategoria
						</div>
					</div>
				}
			</div>
		</div>
	</div>
}

@if (enseñarLanzamiento == true)
{
	<div class="opciones-panel">
		<div style="max-width: 500px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; position: relative; justify-content: center; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); justify-content: center;">
				<button class="boton-pequeño" @onclick="MostrarOcultarLanzamiento" style="width: fit-content; padding: 10px 15px; position: absolute; left: 30px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String29", "HistoricalLows")
				</div>
			</div>

			<div style="display: grid; flex-direction: column; gap: 30px; padding: 30px;">
				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String30", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@lanzamientoChecked0" @onchange="@(e => CambiarLanzamiento(e, 0))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String30", "HistoricalLows")
					</div>
				</div>

				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String31", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@lanzamientoChecked1" @onchange="@(e => CambiarLanzamiento(e, 1))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String31", "HistoricalLows")
					</div>
				</div>

				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String32", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@lanzamientoChecked2" @onchange="@(e => CambiarLanzamiento(e, 2))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String32", "HistoricalLows")
					</div>
				</div>

				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String33", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@lanzamientoChecked3" @onchange="@(e => CambiarLanzamiento(e, 3))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String33", "HistoricalLows")
					</div>
				</div>
			</div>
		</div>
	</div>
}

@if (enseñarIA == true)
{
	<div class="opciones-panel">
		<div style="max-width: 500px; width: 100%; background-color: var(--fondoSubcabecera); border: 2px solid var(--fondoSubcabecera); margin: 20px auto; overflow-y: scroll; position: relative; justify-content: center; scrollbar-color: var(--fondoCodigo) var(--fondoOscuro); border-radius: 20px; box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.28),0px 0px 2px 0px rgba(0, 0, 0, 0.24);">
			<div style="display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: color-mix(in srgb, var(--fondoSubcabecera) 55%, var(--fondoBotonPequeño)); justify-content: center;">
				<button class="boton-pequeño" @onclick="MostrarOcultarIA" style="width: fit-content; padding: 10px 15px; position: absolute; left: 30px;">
					<div style="max-width: 24px; max-height: 24px;">
						<svg class="svg-icono" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
						</svg>
					</div>
				</button>

				<div style="font-size: 20px;">
					@Herramientas.Idiomas.BuscarTexto(idioma, "String36", "HistoricalLows")
				</div>
			</div>

			<div style="display: flex; flex-direction: column; gap: 30px; padding: 30px;">
				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String37", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@inteligenciaArtificialChecked0" @onchange="@(e => CambiarInteligenciaArtificial(e, 0))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String37", "HistoricalLows")
					</div>
				</div>

				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String38", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@inteligenciaArtificialChecked1" @onchange="@(e => CambiarInteligenciaArtificial(e, 1))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String38", "HistoricalLows")
					</div>
				</div>

				<div style="display: flex; align-items: center; gap: 20px;" title="@Herramientas.Idiomas.BuscarTexto(idioma, "String39", "HistoricalLows")">
					<div class="checkbox-caja">
						<input type="checkbox" class="checkbox-interior" checked="@inteligenciaArtificialChecked2" @onchange="@(e => CambiarInteligenciaArtificial(e, 2))">
					</div>

					<div>
						@Herramientas.Idiomas.BuscarTexto(idioma, "String39", "HistoricalLows")
					</div>
				</div>
			</div>
		</div>
	</div>
}

@code {

	#nullable disable

	private string idioma = "en";
	private string usuarioId = null;
	private string userAgent = null;
	private string dominio = null;

	[PersistentState] public Herramientas.UsuarioListadosJuegos juegosUsuario { get; set; }
	[PersistentState] public Usuario deseadosUsuario { get; set; }
	private bool usuarioPatreon = false;
	[PersistentState] public Usuario opcionesMinimos { get; set; }

	[SupplyParameterFromQuery] private string DRMs { get; set; }
	[SupplyParameterFromQuery] private string Stores { get; set; }
	[SupplyParameterFromQuery] private string Categories { get; set; }
	[SupplyParameterFromQuery] private string MinDiscount { get; set; }
	[SupplyParameterFromQuery] private string MaxPrice { get; set; }
	[SupplyParameterFromQuery] private string Deck { get; set; }
	[SupplyParameterFromQuery] private string SteamOS { get; set; }
	[SupplyParameterFromQuery] private string Release { get; set; }
	[SupplyParameterFromQuery] private string AI { get; set; }
	[SupplyParameterFromQuery] private string MinReviews { get; set; }

	[PersistentState] public List<Juegos.Juego> juegosGestor { get; set; }
	[PersistentState] public List<JuegoMostrar> juegosMostrar { get; set; }

	private int posicion = 0;
	private string ordenamientoElegido = string.Empty;

	private bool cargado = false;

	protected override async Task OnInitializedAsync()
	{
		Herramientas.ContextoUsuarioDatos datos = Herramientas.ContextoUsuario.Leer(Contexto);
		idioma = datos.Idioma;
		usuarioId = datos.UsuarioId;
		userAgent = datos.UserAgent;
		dominio = datos.Dominio;

		if (string.IsNullOrEmpty(usuarioId) == false)
		{
			idioma = await BaseDatos.Usuarios.Buscar.IdiomaSobreescribir(usuarioId);
			juegosUsuario ??= await Herramientas.UsuarioJuegos.Cargar(usuarioId);
			deseadosUsuario ??= await BaseDatos.Usuarios.Buscar.DeseadosTiene(usuarioId);
			usuarioPatreon = Herramientas.Patreon.VerificarActivo(await BaseDatos.Usuarios.Buscar.FechaPatreon(usuarioId));
			opcionesMinimos ??= await BaseDatos.Usuarios.Buscar.OpcionesMinimos(usuarioId);

			if (opcionesMinimos != null)
			{
				#region Filtrado

				if (opcionesMinimos.HistoricalLowsSort != null)
				{
					opcionesMinimos.HistoricalLowsSort = 1;
				}

				if (opcionesMinimos.HistoricalLowsOption1 == true)
				{
					ocultarJuegosUsuarioSteam = "checked";
				}
				else
				{
					ocultarJuegosUsuarioSteam = null;
				}

				if (opcionesMinimos.HistoricalLowsOption4 == true)
				{
					ocultarJuegosUsuarioGog = "checked";
				}
				else
				{
					ocultarJuegosUsuarioGog = null;
				}

				if (opcionesMinimos.HistoricalLowsOption2.HasValue == true)
				{
					descuentoMinimo = opcionesMinimos.HistoricalLowsOption2.Value;
				}

				if (opcionesMinimos.HistoricalLowsOption3.HasValue == true)
				{
					precioMaximo = opcionesMinimos.HistoricalLowsOption3.Value;
				}

				if (string.IsNullOrEmpty(opcionesMinimos.HistoricalLowsDRMs) == false)
				{
					drmsListado = JsonSerializer.Deserialize<List<MostrarJuegoDRM>>(opcionesMinimos.HistoricalLowsDRMs);
				}

				if (string.IsNullOrEmpty(opcionesMinimos.HistoricalLowsStores) == false)
				{
					tiendas = JsonSerializer.Deserialize<List<MostrarJuegoTienda>>(opcionesMinimos.HistoricalLowsStores);
					tiendas = GenerarListaTiendas(tiendas);
				}

				if (string.IsNullOrEmpty(opcionesMinimos.HistoricalLowsCategories) == false)
				{
					categorias = JsonSerializer.Deserialize<List<MostrarJuegoCategoria>>(opcionesMinimos.HistoricalLowsCategories);
				}

				if (opcionesMinimos.HistoricalLowsRelease == null)
				{
					lanzamientoElegido = 0;
				}
				else
				{
					lanzamientoElegido = (int)opcionesMinimos.HistoricalLowsRelease;
				}

				if (lanzamientoElegido == 0)
				{
					lanzamientoChecked0 = "checked";
					lanzamientoChecked1 = null;
					lanzamientoChecked2 = null;
					lanzamientoChecked3 = null;
				}
				else if (lanzamientoElegido == 1)
				{
					lanzamientoChecked0 = null;
					lanzamientoChecked1 = "checked";
					lanzamientoChecked2 = null;
					lanzamientoChecked3 = null;
				}
				else if (lanzamientoElegido == 2)
				{
					lanzamientoChecked0 = null;
					lanzamientoChecked1 = null;
					lanzamientoChecked2 = "checked";
					lanzamientoChecked3 = null;
				}
				else if (lanzamientoElegido == 3)
				{
					lanzamientoChecked0 = null;
					lanzamientoChecked1 = null;
					lanzamientoChecked2 = null;
					lanzamientoChecked3 = "checked";
				}

				if (opcionesMinimos.HistoricalLowsAI == null)
				{
					inteligenciaArtificialElegida = 0;
				}
				else
				{
					inteligenciaArtificialElegida = (int)opcionesMinimos.HistoricalLowsAI;
				}

				if (inteligenciaArtificialElegida == 0)
				{
					inteligenciaArtificialChecked0 = "checked";
					inteligenciaArtificialChecked1 = null;
					inteligenciaArtificialChecked2 = null;
				}
				else if (inteligenciaArtificialElegida == 1)
				{
					inteligenciaArtificialChecked0 = null;
					inteligenciaArtificialChecked1 = "checked";
					inteligenciaArtificialChecked2 = null;
				}
				else if (inteligenciaArtificialElegida == 2)
				{
					inteligenciaArtificialChecked0 = null;
					inteligenciaArtificialChecked1 = null;
					inteligenciaArtificialChecked2 = "checked";
				}

				if (opcionesMinimos.HistoricalLowsReviews.HasValue == true)
				{
					minimoReseñas = opcionesMinimos.HistoricalLowsReviews.Value;
				}

				#endregion
			}
		}

		if (string.IsNullOrEmpty(DRMs) == false)
		{
			foreach (var drm in drmsListado)
			{
				drm.Checkbox = null;
				drm.Estado = false;
			}

			List<string> drmsEnlace = DRMs.Split(',').ToList();

			foreach (var drmEnlace in drmsEnlace)
			{
				foreach (var drm in drmsListado)
				{
					if (drm.DRMId.ToString() == drmEnlace)
					{
						drm.Estado = true;
						drm.Checkbox = "checked";
						break;
					}
				}
			}
		}

		if (string.IsNullOrEmpty(Stores) == false)
		{
			foreach (var tienda in tiendas)
			{
				tienda.Checkbox = null;
				tienda.Estado = false;
			}

			List<string> tiendasEnlace = Stores.Split(',').ToList();

			foreach (var tiendaEnlace in tiendasEnlace)
			{
				foreach (var tienda in tiendas)
				{
					if (tienda.TiendaId == tiendaEnlace)
					{
						tienda.Estado = true;
						tienda.Checkbox = "checked";
						break;
					}
				}
			}

			tiendas = GenerarListaTiendas(tiendas);
		}

		if (string.IsNullOrEmpty(Categories) == false)
		{
			foreach (var categoria in categorias)
			{
				categoria.Checkbox = null;
				categoria.Estado = false;
			}

			List<string> categoriasEnlace = Categories.Split(',').ToList();

			foreach (var categoriaEnlace in categoriasEnlace)
			{
				foreach (var categoria in categorias)
				{
					if (categoria.Categoria.ToString() == categoriaEnlace)
					{
						categoria.Estado = true;
						categoria.Checkbox = "checked";
						break;
					}
				}
			}
		}

		if (string.IsNullOrEmpty(MinDiscount) == false)
		{
			if (int.TryParse(MinDiscount, out int descuento))
			{
				descuentoMinimo = descuento;
			}
			else
			{
				descuentoMinimo = 1;
			}
		}

		if (string.IsNullOrEmpty(MaxPrice) == false)
		{
			if (int.TryParse(MaxPrice, out int precio))
			{
				precioMaximo = precio;
			}
			else
			{
				precioMaximo = 100;
			}
		}

		if (string.IsNullOrEmpty(Deck) == false)
		{
			foreach (var deck in deckListado)
			{
				deck.Checkbox = null;
				deck.Estado = false;
			}

			List<string> decksEnlace = Deck.Split(',').ToList();

			foreach (var deckEnlace in decksEnlace)
			{
				foreach (var deck in deckListado)
				{
					if (((int)deck.Tipo).ToString() == deckEnlace)
					{
						deck.Estado = true;
						deck.Checkbox = "checked";
						break;
					}
				}
			}
		}

		if (string.IsNullOrEmpty(SteamOS) == false)
		{
			foreach (var steamos in steamosListado)
			{
				steamos.Checkbox = null;
				steamos.Estado = false;
			}

			List<string> steamosEnlace = SteamOS.Split(',').ToList();

			foreach (var enlace in steamosEnlace)
			{
				foreach (var steamos in steamosListado)
				{
					if (((int)steamos.Tipo).ToString() == enlace)
					{
						steamos.Estado = true;
						steamos.Checkbox = "checked";
						break;
					}
				}
			}
		}

		if (string.IsNullOrEmpty(Release) == false)
		{
			if (int.TryParse(Release, out int lanzamiento))
			{
				lanzamientoElegido = lanzamiento;

				if (lanzamientoElegido == 0)
				{
					lanzamientoChecked0 = "checked";
					lanzamientoChecked1 = null;
					lanzamientoChecked2 = null;
					lanzamientoChecked3 = null;
				}
				else if (lanzamientoElegido == 1)
				{
					lanzamientoChecked0 = null;
					lanzamientoChecked1 = "checked";
					lanzamientoChecked2 = null;
					lanzamientoChecked3 = null;
				}
				else if (lanzamientoElegido == 2)
				{
					lanzamientoChecked0 = null;
					lanzamientoChecked1 = null;
					lanzamientoChecked2 = "checked";
					lanzamientoChecked3 = null;
				}
				else if (lanzamientoElegido == 3)
				{
					lanzamientoChecked0 = null;
					lanzamientoChecked1 = null;
					lanzamientoChecked2 = null;
					lanzamientoChecked3 = "checked";
				}
			}
			else
			{
				lanzamientoElegido = 0;

				lanzamientoChecked0 = "checked";
				lanzamientoChecked1 = null;
				lanzamientoChecked2 = null;
				lanzamientoChecked3 = null;
			}
		}

		if (string.IsNullOrEmpty(AI) == false)
		{
			if (int.TryParse(AI, out int inteligencia))
			{
				inteligenciaArtificialElegida = inteligencia;

				if (inteligenciaArtificialElegida == 0)
				{
					inteligenciaArtificialChecked0 = "checked";
					inteligenciaArtificialChecked1 = null;
					inteligenciaArtificialChecked2 = null;
				}
				else if (inteligenciaArtificialElegida == 1)
				{
					inteligenciaArtificialChecked0 = null;
					inteligenciaArtificialChecked1 = "checked";
					inteligenciaArtificialChecked2 = null;
				}
				else if (inteligenciaArtificialElegida == 2)
				{
					inteligenciaArtificialChecked0 = null;
					inteligenciaArtificialChecked1 = null;
					inteligenciaArtificialChecked2 = "checked";
				}
			}
			else
			{
				inteligenciaArtificialElegida = 0;

				inteligenciaArtificialChecked0 = "checked";
				inteligenciaArtificialChecked1 = null;
				inteligenciaArtificialChecked2 = null;
			}
		}

		if (string.IsNullOrEmpty(MinReviews) == false)
		{
			if (int.TryParse(MinReviews, out int reseñas))
			{
				minimoReseñas = reseñas;
			}
			else
			{
				minimoReseñas = 0;
			}
		}

		if (string.IsNullOrEmpty(usuarioId) == false)
		{
			opcionesMinimos ??= await BaseDatos.Usuarios.Buscar.OpcionesMinimos(usuarioId);
		}
	}

	protected override async Task OnAfterRenderAsync(bool primerRender)
	{
		if (primerRender == true)
		{
			await CambiarEnlace();

			cargado = false;

			if (opcionesMinimos == null)
			{
				await OrdenarReseñasCantidad(true);
			}
			else
			{
				if (opcionesMinimos.HistoricalLowsSort == null)
				{
					opcionesMinimos.HistoricalLowsSort = 1;
				}

				if (opcionesMinimos.HistoricalLowsSort == 0)
				{
					await OrdenarReseñasPorcentaje(true);
				}
				else if (opcionesMinimos.HistoricalLowsSort == 1)
				{
					await OrdenarReseñasCantidad(true);
				}
				else if (opcionesMinimos.HistoricalLowsSort == 2)
				{
					await OrdenarNombreAZ(true);
				}
				else if (opcionesMinimos.HistoricalLowsSort == 3)
				{
					await OrdenarNombreZA(true);
				}
				else if (opcionesMinimos.HistoricalLowsSort == 4)
				{
					await OrdenarPrecio(true);
				}
				else if (opcionesMinimos.HistoricalLowsSort == 5)
				{
					await OrdenarDescuento(true);
				}
				else if (opcionesMinimos.HistoricalLowsSort == 6)
				{
					await OrdenarFechaDetectado(true);
				}
			}

			cargado = true;
			await InvokeAsync(StateHasChanged);
		}
	}

	#region Ordenar

	private bool mostrarOrdenar = false;

	private async Task MostrarOcultarOrdenar()
	{
		mostrarOrdenar = !mostrarOrdenar;
	}

	private async Task OrdenarReseñasPorcentaje(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String3", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 1, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 0;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 0, usuarioId);
			}
		}
	}

	private async Task OrdenarReseñasCantidad(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String4", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 0, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));					
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 1;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 1, usuarioId);
			}
		}
	}

	private async Task OrdenarNombreAZ(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String5", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 2, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 2;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 2, usuarioId);
			}
		}
	}

	private async Task OrdenarNombreZA(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String6", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 3, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));					
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 3;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 3, usuarioId);
			}
		}
	}

	private async Task OrdenarPrecio(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String7", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 4, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 4;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 4, usuarioId);
			}
		}
	}

	private async Task OrdenarDescuento(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String8", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 5, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 5;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 5, usuarioId);
			}
		}
	}

	private async Task OrdenarFechaDetectado(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String34", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 6, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosGestor?.Count > 0)
			{
				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 6;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 6, usuarioId);
			}
		}
	}

	private async Task OrdenarFechaLanzamiento(bool buscar = true, bool fusionar = false)
	{
		ordenamientoElegido = Herramientas.Idiomas.BuscarTexto(idioma, "String35", "HistoricalLows");

		if (buscar == true)
		{
			juegosGestor = await BaseDatos.Juegos.Buscar.Minimos(posicion, 7, tiendas, drmsListado, categorias, descuentoMinimo, precioMaximo, deckListado, steamosListado, lanzamientoElegido, inteligenciaArtificialElegida, minimoReseñas, textoBuscador);

			if (juegosMostrar.Count > 0)
			{
				var juegosMostradosIds = juegosMostrar.Select(j => j.Juego).ToList();
				var juegosRestantes = juegosGestor.Except(juegosMostradosIds).ToList();

				if (fusionar == false)
				{
					juegosMostrar = Filtros(juegosGestor);
				}
				else
				{
					juegosMostrar.AddRange(Filtros(juegosGestor));
				}
			}
		}
		else
		{
			juegosMostrar = Filtros(juegosGestor);
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSort = 7;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSort", 7, usuarioId);
			}
		}
	}

	#endregion

	#region Filtrado

	private List<JuegoMostrar> Filtros(List<Juegos.Juego> lista)
	{
		cargado = false;

		List<JuegoMostrar> listaMostrar = new List<JuegoMostrar>();

		if (string.IsNullOrEmpty(ocultarJuegosUsuarioSteam) == false)
		{
			if (ocultarJuegosUsuarioSteam == "checked")
			{
				lista = lista.Where(j => !juegosUsuario.Steam.Any(jU => jU.Id == j.IdSteam && j.PrecioMinimosHistoricos[0].DRM == JuegoDRM.Steam)).ToList();
			}
		}

		if (string.IsNullOrEmpty(ocultarJuegosUsuarioGog) == false)
		{
			if (ocultarJuegosUsuarioGog == "checked")
			{
				lista = lista.Where(j => !juegosUsuario.Gog.Any(jU => jU.Id == j.IdGog && j.PrecioMinimosHistoricos[0].DRM == JuegoDRM.GOG)).ToList();
			}
		}

		lista.ForEach(j =>
		{
			JuegoMostrar juegoMostrar = new JuegoMostrar
			{
				Juego = j,
				DeseadoImportado = false,
				Color = "var(--fondoBotonPequeño)"
			};

			if (Herramientas.UsuarioJuegos.ComprobarSiTiene(juegosUsuario, j, j.PrecioMinimosHistoricos[0].DRM) == true)
			{
				juegoMostrar.Color = "var(--fondoBien)";
			}
			else
			{
				if (Herramientas.Deseados.ComprobarSiEstaImportado(deseadosUsuario, j, j.PrecioMinimosHistoricos[0].DRM, true) == true)
				{
					juegoMostrar.Color = "var(--fondoAlerta)";
					juegoMostrar.DeseadoImportado = true;
				}

				if (Herramientas.Deseados.ComprobarSiEstaWeb(deseadosUsuario, j, j.PrecioMinimosHistoricos[0].DRM, true) == true)
				{
					juegoMostrar.Color = "var(--fondoAlerta)";
				}
			}

			listaMostrar.Add(juegoMostrar);
		});

		cargado = true;

		return listaMostrar;
	}

	private async Task ElegirOrdenamiento(bool buscar)
	{
		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String3", "HistoricalLows"))
		{
			await OrdenarReseñasPorcentaje(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String4", "HistoricalLows"))
		{
			await OrdenarReseñasCantidad(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String5", "HistoricalLows"))
		{
			await OrdenarNombreAZ(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String6", "HistoricalLows"))
		{
			await OrdenarNombreZA(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String7", "HistoricalLows"))
		{
			await OrdenarPrecio(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String8", "HistoricalLows"))
		{
			await OrdenarDescuento(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String34", "HistoricalLows"))
		{
			await OrdenarFechaDetectado(buscar);
		}

		if (ordenamientoElegido == Herramientas.Idiomas.BuscarTexto(idioma, "String35", "HistoricalLows"))
		{
			await OrdenarFechaLanzamiento(buscar);
		}

		await CambiarEnlace();
	}

	private async Task CambiarEnlace()
	{
		string drmsTexto = string.Empty;

		foreach (var drm in drmsListado)
		{
			if (drm.Estado == true)
			{
				drmsTexto += drm.DRMId.ToString() + ",";
			}
		}

		if (string.IsNullOrEmpty(drmsTexto) == false)
		{
			drmsTexto = "drms=" + drmsTexto.TrimEnd(',');
		}

		string tiendasTexto = string.Empty;

		foreach (var tienda in tiendas)
		{
			if (tienda.Estado == true)
			{
				tiendasTexto += tienda.TiendaId.ToString() + ",";
			}
		}

		if (string.IsNullOrEmpty(tiendasTexto) == false)
		{
			tiendasTexto = "&stores=" + tiendasTexto.TrimEnd(',');
		}

		string categoriasTexto = string.Empty;

		foreach (var categoria in categorias)
		{
			if (categoria.Estado == true)
			{
				categoriasTexto += categoria.Categoria.ToString() + ",";
			}
		}

		if (string.IsNullOrEmpty(categoriasTexto) == false)
		{
			categoriasTexto = "&categories=" + categoriasTexto.TrimEnd(',');
		}

		string minimoDescuentoTexto = string.Empty;

		if (descuentoMinimo > 0)
		{
			minimoDescuentoTexto = "&mindiscount=" + descuentoMinimo;
		}

		string maximoPrecioTexto = string.Empty;

		if (precioMaximo > 0)
		{
			maximoPrecioTexto = "&maxprice=" + precioMaximo;
		}

		string minimoReseñasTexto = string.Empty;

		if (minimoReseñas > 0)
		{
			minimoReseñasTexto = "&minreviews=" + minimoReseñas;
		}

		string deckTexto = string.Empty;

		foreach (var deck in deckListado)
		{
			if (deck.Estado == true)
			{
				deckTexto += ((int)deck.Tipo).ToString() + ",";
			}
		}

		if (string.IsNullOrEmpty(deckTexto) == false)
		{
			deckTexto = "&deck=" + deckTexto.TrimEnd(',');
		}

		string steamosTexto = string.Empty;

		foreach (var steamos in steamosListado)
		{
			if (steamos.Estado == true)
			{
				steamosTexto += ((int)steamos.Tipo).ToString() + ",";
			}
		}

		if (string.IsNullOrEmpty(steamosTexto) == false)
		{
			steamosTexto = "&steamos=" + steamosTexto.TrimEnd(',');
		}

		string lanzamientoTexto = string.Empty;

		if (lanzamientoElegido >= 0)
		{
			lanzamientoTexto = "&release=" + lanzamientoElegido.ToString();
		}

		string inteligenciaArtificialTexto = string.Empty;

		if (inteligenciaArtificialElegida >= 0)
		{
			inteligenciaArtificialTexto = "&ai=" + inteligenciaArtificialElegida.ToString();
		}

		await JavaScript.InvokeVoidAsync("ChangeUrl", "/historical-lows?" + drmsTexto + tiendasTexto + categoriasTexto + minimoDescuentoTexto + maximoPrecioTexto + minimoReseñasTexto + deckTexto + lanzamientoTexto + inteligenciaArtificialTexto);
	}

	#endregion

	#region Opciones Usuario

	private bool mostrarOpciones { get; set; } = false;

	private async Task MostrarOcultarOpciones()
	{
		mostrarOpciones = !mostrarOpciones;
	}

	private string ocultarJuegosUsuarioSteam = null;

	private async Task OcultarJuegosUsuarioSteam()
	{
		if (opcionesMinimos != null)
		{
			if (opcionesMinimos.HistoricalLowsOption1 == true)
			{
				opcionesMinimos.HistoricalLowsOption1 = false;
				ocultarJuegosUsuarioSteam = null;
			}
			else
			{
				opcionesMinimos.HistoricalLowsOption1 = true;
				ocultarJuegosUsuarioSteam = "checked";
			}

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsOption1", (bool)opcionesMinimos.HistoricalLowsOption1, usuarioId);
			}

			await ElegirOrdenamiento(false);
		}
	}

	private string ocultarJuegosUsuarioGog = null;

	private async Task OcultarJuegosUsuarioGog()
	{
		if (opcionesMinimos != null)
		{
			if (opcionesMinimos.HistoricalLowsOption4 == true)
			{
				opcionesMinimos.HistoricalLowsOption4 = false;
				ocultarJuegosUsuarioGog = null;
			}
			else
			{
				opcionesMinimos.HistoricalLowsOption4 = true;
				ocultarJuegosUsuarioGog = "checked";
			}

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsOption4", (bool)opcionesMinimos.HistoricalLowsOption1, usuarioId);
			}

			await ElegirOrdenamiento(false);
		}
	}

	private int descuentoMinimo = 0;

	private async Task CambiarDescuentoMinimo()
	{
		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsOption2 = descuentoMinimo;
		}

		if (string.IsNullOrEmpty(usuarioId) == false)
		{
			await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsOption2", descuentoMinimo, usuarioId);
		}

		await ElegirOrdenamiento(true);
	}

	private int precioMaximo = 100;

	private async Task CambiarPrecioMaximo()
	{
		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsOption3 = precioMaximo;
		}

		if (string.IsNullOrEmpty(usuarioId) == false)
		{
			await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsOption3", precioMaximo, usuarioId);
		}

		await ElegirOrdenamiento(true);
	}

	private bool enseñarDRMs { get; set; } = false;

	private async Task MostrarOcultarDRMs()
	{
		enseñarDRMs = !enseñarDRMs;
	}

	private async Task EnseñarJuegosDRM(ChangeEventArgs e, JuegoDRM drmElegido)
	{
		foreach (var drm in drmsListado)
		{
			if (drm.DRMId == drmElegido)
			{
				if (drm.Checkbox == null)
				{
					drm.Checkbox = "checked";
					drm.Estado = true;
				}
				else
				{
					drm.Checkbox = null;
					drm.Estado = false;
				}
			}
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsDRMs = JsonSerializer.Serialize(drmsListado);

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsDRMs", opcionesMinimos.HistoricalLowsDRMs, usuarioId);
			}
		}

		await ElegirOrdenamiento(true);
	}

	private List<MostrarJuegoDRM> drmsListado = CrearListaDRMs();

	public class MostrarJuegoDRM
	{
		public bool Estado { get; set; }
		public string Checkbox { get; set; }
		public JuegoDRM DRMId { get; set; }
	}

	private static List<MostrarJuegoDRM> CrearListaDRMs()
	{
		List<MostrarJuegoDRM> nuevaLista = new List<MostrarJuegoDRM>();

		foreach (var drm in JuegoDRM2.GenerarListado())
		{
			MostrarJuegoDRM nuevoDRM = new MostrarJuegoDRM();
			nuevoDRM.Estado = false;
			nuevoDRM.Checkbox = null;
			nuevoDRM.DRMId = drm.Id;

			if (nuevoDRM.DRMId == JuegoDRM.Steam || nuevoDRM.DRMId == JuegoDRM.GOG || nuevoDRM.DRMId == JuegoDRM.Ubisoft || nuevoDRM.DRMId == JuegoDRM.EA)
			{
				nuevoDRM.Estado = true;
				nuevoDRM.Checkbox = "checked";
			}

			nuevaLista.Add(nuevoDRM);
		}

		return nuevaLista;
	}

	private bool enseñarTiendas { get; set; } = false;

	private async Task MostrarOcultarTiendas()
	{
		enseñarTiendas = !enseñarTiendas;
	}

	private async Task EnseñarJuegosTienda(ChangeEventArgs e, string tiendaElegida)
	{
		foreach (var tienda in tiendas)
		{
			if (tienda.TiendaId == tiendaElegida)
			{
				if (tienda.Checkbox == null)
				{
					tienda.Checkbox = "checked";
					tienda.Estado = true;
				}
				else
				{
					tienda.Checkbox = null;
					tienda.Estado = false;
				}
			}
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsStores = JsonSerializer.Serialize(tiendas);

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsStores", opcionesMinimos.HistoricalLowsStores, usuarioId);
			}
		}

		await ElegirOrdenamiento(true);
	}

	private List<MostrarJuegoTienda> tiendas = GenerarListaTiendas();

	public class MostrarJuegoTienda
	{
		public bool Estado { get; set; }
		public string Checkbox { get; set; }
		public string TiendaId { get; set; }
	}

	private static List<MostrarJuegoTienda> GenerarListaTiendas(List<MostrarJuegoTienda> viejaLista = null)
	{
		List<MostrarJuegoTienda> nuevaLista = new List<MostrarJuegoTienda>();

		foreach (var tienda in Tiendas2.TiendasCargar.GenerarListado())
		{
			if (tienda.UsuarioInteractuar == true)
			{
				MostrarJuegoTienda nuevaTienda = new MostrarJuegoTienda();
				nuevaTienda.TiendaId = tienda.Id;

				if (viejaLista != null)
				{
					nuevaTienda.Estado = false;
					nuevaTienda.Checkbox = null;

					foreach (var viejaTienda in viejaLista)
					{
						if (viejaTienda.TiendaId == tienda.Id)
						{
							nuevaTienda.Estado = viejaTienda.Estado;
							nuevaTienda.Checkbox = viejaTienda.Checkbox;
						}
					}
				}
				else
				{
					nuevaTienda.Estado = true;
					nuevaTienda.Checkbox = "checked";
				}

				nuevaLista.Add(nuevaTienda);
			}
		}

		return nuevaLista;
	}

	private int minimoReseñas = 500;

	private async Task CambiarReseñasMinimo()
	{
		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsReviews = minimoReseñas;
		}

		if (string.IsNullOrEmpty(usuarioId) == false)
		{
			await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsReviews", minimoReseñas, usuarioId);
		}

		await ElegirOrdenamiento(true);
	}

	private bool enseñarCategorias { get; set; } = false;

	private async Task MostrarOcultarCategorias()
	{
		enseñarCategorias = !enseñarCategorias;
	}

	private async Task EnseñarJuegosCategoria(ChangeEventArgs e, JuegoTipo categoriaElegida)
	{
		foreach (var categoria in categorias)
		{
			if (categoria.Categoria == categoriaElegida)
			{
				if (categoria.Checkbox == null)
				{
					categoria.Checkbox = "checked";
					categoria.Estado = true;
				}
				else
				{
					categoria.Checkbox = null;
					categoria.Estado = false;
				}
			}
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsCategories = JsonSerializer.Serialize(categorias);

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsCategories", opcionesMinimos.HistoricalLowsCategories, usuarioId);
			}
		}

		await ElegirOrdenamiento(true);
	}

	private List<MostrarJuegoCategoria> categorias = CrearListaCategorias();

	public class MostrarJuegoCategoria
	{
		public bool Estado { get; set; }
		public string Checkbox { get; set; }
		public JuegoTipo Categoria { get; set; }
	}

	private static List<MostrarJuegoCategoria> CrearListaCategorias()
	{
		List<MostrarJuegoCategoria> nuevaLista = new List<MostrarJuegoCategoria>();

		foreach (var categoria in JuegoTipos.CargarListado())
		{
			if (categoria != JuegoTipo.Bundle)
			{
				MostrarJuegoCategoria nuevaCategoria = new MostrarJuegoCategoria();
				nuevaCategoria.Estado = true;
				nuevaCategoria.Checkbox = "checked";
				nuevaCategoria.Categoria = categoria;

				nuevaLista.Add(nuevaCategoria);
			}
		}

		return nuevaLista;
	}

	private async Task EnseñarJuegosSteamDeck(ChangeEventArgs e, JuegoDeck tipoElegido)
	{
		foreach (var steamdeck in deckListado)
		{
			if (steamdeck.Tipo == tipoElegido)
			{
				if (steamdeck.Checkbox == null)
				{
					steamdeck.Checkbox = "checked";
					steamdeck.Estado = true;
				}
				else
				{
					steamdeck.Checkbox = null;
					steamdeck.Estado = false;
				}
			}
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSteamDeck = JsonSerializer.Serialize(deckListado);

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSteamDeck", opcionesMinimos.HistoricalLowsSteamDeck, usuarioId);
			}
		}

		await ElegirOrdenamiento(true);
	}

	private List<MostrarJuegoSteamDeck> deckListado = CrearListaSteamDeck();

	public class MostrarJuegoSteamDeck
	{
		public bool Estado { get; set; }
		public string Checkbox { get; set; }
		public JuegoDeck Tipo { get; set; }
	}

	private static List<MostrarJuegoSteamDeck> CrearListaSteamDeck()
	{
		List<MostrarJuegoSteamDeck> nuevaLista = new List<MostrarJuegoSteamDeck>();

		MostrarJuegoSteamDeck nuevoTipo1 = new MostrarJuegoSteamDeck();
		nuevoTipo1.Estado = true;
		nuevoTipo1.Checkbox = "checked";
		nuevoTipo1.Tipo = JuegoDeck.Verificado;
		nuevaLista.Add(nuevoTipo1);

		MostrarJuegoSteamDeck nuevoTipo2 = new MostrarJuegoSteamDeck();
		nuevoTipo2.Estado = true;
		nuevoTipo2.Checkbox = "checked";
		nuevoTipo2.Tipo = JuegoDeck.Jugable;
		nuevaLista.Add(nuevoTipo2);

		MostrarJuegoSteamDeck nuevoTipo3 = new MostrarJuegoSteamDeck();
		nuevoTipo3.Estado = true;
		nuevoTipo3.Checkbox = "checked";
		nuevoTipo3.Tipo = JuegoDeck.NoSoportado;
		nuevaLista.Add(nuevoTipo3);

		MostrarJuegoSteamDeck nuevoTipo4 = new MostrarJuegoSteamDeck();
		nuevoTipo4.Estado = true;
		nuevoTipo4.Checkbox = "checked";
		nuevoTipo4.Tipo = JuegoDeck.Desconocido;
		nuevaLista.Add(nuevoTipo4);

		return nuevaLista;
	}

	private async Task EnseñarJuegosSteamOS(ChangeEventArgs e, JuegoSteamOS tipoElegido)
	{
		foreach (var steamos in steamosListado)
		{
			if (steamos.Tipo == tipoElegido)
			{
				if (steamos.Checkbox == null)
				{
					steamos.Checkbox = "checked";
					steamos.Estado = true;
				}
				else
				{
					steamos.Checkbox = null;
					steamos.Estado = false;
				}
			}
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsSteamOS = JsonSerializer.Serialize(steamosListado);

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsSteamOS", opcionesMinimos.HistoricalLowsSteamOS, usuarioId);
			}
		}

		await ElegirOrdenamiento(true);
	}

	private List<MostrarJuegoSteamOS> steamosListado = CrearListaSteamOS();

	public class MostrarJuegoSteamOS
	{
		public bool Estado { get; set; }
		public string Checkbox { get; set; }
		public JuegoSteamOS Tipo { get; set; }
	}

	private static List<MostrarJuegoSteamOS> CrearListaSteamOS()
	{
		List<MostrarJuegoSteamOS> nuevaLista = new List<MostrarJuegoSteamOS>();

		MostrarJuegoSteamOS nuevoTipo1 = new MostrarJuegoSteamOS();
		nuevoTipo1.Estado = true;
		nuevoTipo1.Checkbox = "checked";
		nuevoTipo1.Tipo = JuegoSteamOS.Verificado;
		nuevaLista.Add(nuevoTipo1);

		MostrarJuegoSteamOS nuevoTipo2 = new MostrarJuegoSteamOS();
		nuevoTipo2.Estado = true;
		nuevoTipo2.Checkbox = "checked";
		nuevoTipo2.Tipo = JuegoSteamOS.NoSoportado;
		nuevaLista.Add(nuevoTipo2);

		MostrarJuegoSteamOS nuevoTipo3 = new MostrarJuegoSteamOS();
		nuevoTipo3.Estado = true;
		nuevoTipo3.Checkbox = "checked";
		nuevoTipo3.Tipo = JuegoSteamOS.Desconocido;
		nuevaLista.Add(nuevoTipo3);

		return nuevaLista;
	}

	private bool enseñarLanzamiento { get; set; } = false;

	private async Task MostrarOcultarLanzamiento()
	{
		enseñarLanzamiento = !enseñarLanzamiento;
	}

	private int lanzamientoElegido = 0;
	private string lanzamientoChecked0 = null;
	private string lanzamientoChecked1 = null;
	private string lanzamientoChecked2 = null;
	private string lanzamientoChecked3 = null;

	private async Task CambiarLanzamiento(ChangeEventArgs e, int nuevoLanzamiento)
	{
		lanzamientoElegido = nuevoLanzamiento;

		lanzamientoChecked0 = null;
		lanzamientoChecked1 = null;
		lanzamientoChecked2 = null;
		lanzamientoChecked3 = null;

		if (lanzamientoElegido == 0)
		{
			lanzamientoChecked0 = "checked";
		}
		else if (lanzamientoElegido == 1)
		{
			lanzamientoChecked1 = "checked";
		}
		else if (lanzamientoElegido == 2)
		{
			lanzamientoChecked2 = "checked";
		}
		else if (lanzamientoElegido == 3)
		{
			lanzamientoChecked3 = "checked";
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsRelease = lanzamientoElegido;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsRelease", opcionesMinimos.HistoricalLowsRelease.ToString(), usuarioId);
			}		
		}

		await ElegirOrdenamiento(true);
	}

	private bool enseñarIA { get; set; } = false;

	private async Task MostrarOcultarIA()
	{
		enseñarIA = !enseñarIA;
	}

	private int inteligenciaArtificialElegida = 0;
	private string inteligenciaArtificialChecked0 = null;
	private string inteligenciaArtificialChecked1 = null;
	private string inteligenciaArtificialChecked2 = null;

	private async Task CambiarInteligenciaArtificial(ChangeEventArgs e, int nuevaInteligenciaArtificial)
	{
		inteligenciaArtificialElegida = nuevaInteligenciaArtificial;

		inteligenciaArtificialChecked0 = null;
		inteligenciaArtificialChecked1 = null;
		inteligenciaArtificialChecked2 = null;

		if (inteligenciaArtificialElegida == 0)
		{
			inteligenciaArtificialChecked0 = "checked";
		}
		else if (inteligenciaArtificialElegida == 1)
		{
			inteligenciaArtificialChecked1 = "checked";
		}
		else if (inteligenciaArtificialElegida == 2)
		{
			inteligenciaArtificialChecked2 = "checked";
		}

		if (opcionesMinimos != null)
		{
			opcionesMinimos.HistoricalLowsAI = inteligenciaArtificialElegida;

			if (string.IsNullOrEmpty(usuarioId) == false)
			{
				await BaseDatos.Usuarios.Actualizar.Opcion("HistoricalLowsAI", opcionesMinimos.HistoricalLowsAI.ToString(), usuarioId);

			}
		}

		await ElegirOrdenamiento(true);
	}

	#endregion

	public class JuegoMostrar
	{
		public Juegos.Juego Juego { get; set; }
		public bool DeseadoImportado { get; set; }
		public string Color { get; set; }
		public bool DeseadoMostrar { get; set; }
	}

	#region Deseados

	private async Task CambiarEstadoDeseado(MouseEventArgs e, string usuarioId, JuegoMostrar juego, JuegoDRM drm)
	{
		bool estado = true;

		if (juego.Color == "var(--fondoAlerta)")
		{
			estado = false;
		}

		await Herramientas.Deseados.CambiarEstado(usuarioId, juego.Juego, estado, drm, true);

		foreach (var juego2 in juegosMostrar)
		{
			if (juego2.Juego.IdMaestra == juego.Juego.IdMaestra && juego2.Juego.PrecioMinimosHistoricos[0].DRM == drm)
			{
				if (estado == true)
				{
					juego2.Color = "var(--fondoAlerta)";
				}
				else
				{
					juego2.Color = "var(--fondoBotonPequeño)";
				}
			}
		}

		await InvokeAsync(StateHasChanged);
	}

	private void MostrarBotonDeseados(MouseEventArgs e, JuegoMostrar juego)
	{
		juego.DeseadoMostrar = true;
	}

	private void OcultarBotonDeseados(MouseEventArgs e, JuegoMostrar juego)
	{
		juego.DeseadoMostrar = false;
	}

	#endregion

	#region Cargar mas

	private bool cargandoMas = false;

	private async Task CargarMasMinimos()
	{
		posicion = posicion + 100;

		cargandoMas = true;

		if (opcionesMinimos == null)
		{
			await OrdenarReseñasCantidad(true, true);
		}
		else
		{
			if (opcionesMinimos.HistoricalLowsSort == null)
			{
				opcionesMinimos.HistoricalLowsSort = 1;
			}

			if (opcionesMinimos.HistoricalLowsSort == 0)
			{
				await OrdenarReseñasPorcentaje(true, true);
			}
			else if (opcionesMinimos.HistoricalLowsSort == 1)
			{
				await OrdenarReseñasCantidad(true, true);
			}
			else if (opcionesMinimos.HistoricalLowsSort == 2)
			{
				await OrdenarNombreAZ(true, true);
			}
			else if (opcionesMinimos.HistoricalLowsSort == 3)
			{
				await OrdenarNombreZA(true, true);
			}
			else if (opcionesMinimos.HistoricalLowsSort == 4)
			{
				await OrdenarPrecio(true, true);
			}
			else if (opcionesMinimos.HistoricalLowsSort == 5)
			{
				await OrdenarDescuento(true, true);
			}
			else if (opcionesMinimos.HistoricalLowsSort == 6)
			{
				await OrdenarFechaDetectado(true, true);
			}
		}

		cargandoMas = false;
	}

	#endregion

	#region Buscador

	private string textoBuscador { get; set; }
	private bool mostrarBuscador { get; set; } = false;
	private string anchoBuscador => mostrarBuscador ? "width: fit-content;" : "width: 35px;";
	private string fondoBuscador = "background-color: var(--fondoEntrada);";
	private bool haEscrito = false;

	private void MostrarOcultarBuscador()
	{
		mostrarBuscador = !mostrarBuscador;
	}

	private async Task TextoCambiaBuscador()
	{
		await ElegirOrdenamiento(true);

		if (haEscrito == false)
		{
			if (textoBuscador?.Trim().Length > 0)
			{
				haEscrito = true;
			}
		}
		else if (haEscrito == true)
		{
			if (textoBuscador?.Trim().Length == 0)
			{
				mostrarBuscador = false;
				haEscrito = false;
			}
		}
	}

	private void ClickBuscador()
	{
		fondoBuscador = "background-color: var(--fondoBotonPequeñoHover);";
	}

	private void PerderBuscador()
	{
		if (string.IsNullOrEmpty(textoBuscador) == true)
		{
			fondoBuscador = "background-color: var(--fondoEntrada);";
		}
	}

	#endregion

}